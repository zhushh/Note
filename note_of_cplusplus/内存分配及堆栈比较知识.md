## 内存分配知识及堆栈比较

程序结构
----

* 代码段： 存放编译好的机器码，只读数据
* 数据段： 存放全局变量/静态变量/常量
* 堆： 动态分配内存，一般存储由new,malloc,calloc,realloc语句动态分配的内存数据
* 栈： 编译器自动分配和释放，存储函数参数值，局部变量值等

堆栈比较
----
1.性能上
```
栈： 存在于RAM中，是动态的，
堆： 存在于RAM中，是一个通用内存池，所有对象存储在堆中
```

2.申请方式
```
栈： 由系统分配并释放，不用担心内存泄露问题
堆： 需要程序员自己调用分配和手动释放，易造成内存泄露
```

3.申请后系统响应
```
栈： 只要栈的剩余空间大于所申请的空间，系统将为程序提供内存，否则报异常提示栈溢出
堆： 首先应当知道操作系统有一个记录空闲内存的指针链表，当系统收到程序的申请时，会遍历该链表，寻
找第一块空间大于申请空间的堆节点，然后该节点从空闲链表中删除，并把该节点的空间分配给程序；另外
，对于大多数系统，会在这块内存空间的首地址记录本次分配的大小，这样，代码中的delete语句才能正确
的释放内存空间。另外，由于找到的堆节点大小不一定刚好等于申请的大小，系统回自动的将多余的部分重
新放入空闲链表中
```

4.申请大小限制
```
栈： 栈是向低地址扩展的连续的内存区域，它的栈顶指针和最大容量是系统规定好的，申请的空间有限制
堆： 堆是向高低至扩展的不连续的内存区域，大小受限于计算机系统中有效的虚拟内存，所以堆相比于栈来
说更灵活，可以申请的空间也比较大
```

5.申请效率的比较
```
栈： 栈是系统自动分配，一般速度比较快，程序员无法控制
堆： 由new分配，一般速度比较慢，而且容易产生内存碎片，但使用起来方便
```

6.存储的内容
```
栈： 函数调用时，第一个进栈的是主函数中后一条指令（函数调用语句的下一条可执行语句）的地址，然后
是各个参数，在大多数编译器中，参数是从右往左入栈，然后是函数中的局部变量（注意静态变量不入栈）
堆： 一般是在堆的头部用一个字节存放堆的大小，内容由程序员自己安排
```

7.存取效率的比较
```
char s1[] = "aaaaaa";
char *s2  = "bbbbbb";
"aaaaaa"是在运行时候赋值，"bbbbbb"是在编译的时候就确定的；
但是，在栈上存储的数组比指针所指向的字符串（例如堆中）更快
```